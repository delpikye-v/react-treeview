import n,{css as e}from"styled-components";import t,{createContext as o,useContext as r,useRef as i,useState as l,useLayoutEffect as a,useEffect as c}from"react";import{HtmlUtils as d,CmUtils as s}from"@delpi/common";import p from"react-perfect-scrollbar-z";function u(n,e,t){if(t||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function f(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}"function"==typeof SuppressedError&&SuppressedError;var h,x,m,g,b,v,w,k,C,S=n.div(h||(h=f(["\n  margin-left: 30px;\n  position: relative;\n\n  > span,\n  > i {\n    min-height: 20px;\n    vertical-align: middle;\n  }\n\n  .node-data-text {\n    display: inline-block;\n    padding: 0px 5px;\n  }\n\n  .node-data-text-toggle {\n    cursor: pointer;\n  }\n\n  &::after,\n  &::before {\n    content: '';\n    left: -23px;\n    position: absolute;\n    right: auto;\n    cursor: default;\n  }\n\n  &::before {\n    border-left: ","px dashed\n      ",";\n    bottom: 50px;\n    height: 100%;\n    top: -","px;\n    width: 1px;\n  }\n\n  &::after {\n    border-top: ","px dashed\n      ",";\n    height: 20px;\n    top: ","px;\n    width: 27px;\n  }\n\n  &:last-child::before {\n    height: ","px;\n  }\n"],["\n  margin-left: 30px;\n  position: relative;\n\n  > span,\n  > i {\n    min-height: 20px;\n    vertical-align: middle;\n  }\n\n  .node-data-text {\n    display: inline-block;\n    padding: 0px 5px;\n  }\n\n  .node-data-text-toggle {\n    cursor: pointer;\n  }\n\n  &::after,\n  &::before {\n    content: '';\n    left: -23px;\n    position: absolute;\n    right: auto;\n    cursor: default;\n  }\n\n  &::before {\n    border-left: ","px dashed\n      ",";\n    bottom: 50px;\n    height: 100%;\n    top: -","px;\n    width: 1px;\n  }\n\n  &::after {\n    border-top: ","px dashed\n      ",";\n    height: 20px;\n    top: ","px;\n    width: 27px;\n  }\n\n  &:last-child::before {\n    height: ","px;\n  }\n"])),(function(n){return n.showYLine?1:0}),(function(n){return n.lineColor}),(function(){return 12}),(function(n){return n.showXLine?1:0}),(function(n){return n.lineColor}),(function(){return 12}),(function(){return 24})),y=n.span(b||(b=f(["\n  display: inline-block;\n  padding: 3px 7px;\n  border-radius: 6px;\n  -webkit-border-radius: 6px;\n  -moz-border-radius: 6px;\n\n  > div {\n    display: flex;\n  }\n\n  ","\n"],["\n  display: inline-block;\n  padding: 3px 7px;\n  border-radius: 6px;\n  -webkit-border-radius: 6px;\n  -moz-border-radius: 6px;\n\n  > div {\n    display: flex;\n  }\n\n  ","\n"])),(function(n){return n.nodeSelected&&e(g||(g=f(["\n      ","\n      ","\n        color: ",";\n    "],["\n      ","\n      ","\n        color: ",";\n    "])),n.fullRowSelection&&e(x||(x=f(["\n        background-color: ",";\n      "],["\n        background-color: ",";\n      "])),n.selectedBgColor),!n.fullRowSelection&&e(m||(m=f(["\n        .node-data-text {\n          background-color: ",";\n          border-radius: 6px;\n          -webkit-border-radius: 6px;\n          -moz-border-radius: 6px;\n        }\n      "],["\n        .node-data-text {\n          background-color: ",";\n          border-radius: 6px;\n          -webkit-border-radius: 6px;\n          -moz-border-radius: 6px;\n        }\n      "])),n.selectedBgColor),n.selectedColor)})),E=n.i(k||(k=f(["\n  display: inline-block;\n  position: relative;\n  left: 1px;\n  top: 3px;\n  cursor: pointer;\n  width: 14px;\n  height: 14px;\n\n  + .node-data-text {\n    margin-left: 2px;\n  }\n\n  &::before,\n  &::after {\n    content: '';\n    position: absolute;\n    background-color: ",";\n    transition: transform 0.25s ease-out;\n  }\n\n  /* Vertical line */\n  &::before {\n    top: 0px;\n    left: 50%;\n    width: 2px;\n    height: 100%;\n    margin-left: -1px;\n  }\n\n  /* horizontal line */\n  &::after {\n    top: 50%;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    margin-top: -1px;\n  }\n\n  ","\n\n  ","\n"],["\n  display: inline-block;\n  position: relative;\n  left: 1px;\n  top: 3px;\n  cursor: pointer;\n  width: 14px;\n  height: 14px;\n\n  + .node-data-text {\n    margin-left: 2px;\n  }\n\n  &::before,\n  &::after {\n    content: '';\n    position: absolute;\n    background-color: ",";\n    transition: transform 0.25s ease-out;\n  }\n\n  /* Vertical line */\n  &::before {\n    top: 0px;\n    left: 50%;\n    width: 2px;\n    height: 100%;\n    margin-left: -1px;\n  }\n\n  /* horizontal line */\n  &::after {\n    top: 50%;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    margin-top: -1px;\n  }\n\n  ","\n\n  ","\n"])),(function(n){return n.nodeSelected?n.selectedColor:"#4d6878"}),(function(n){return n.disabled&&e(v||(v=f(["\n      cursor: default;\n      pointer-events: none;\n      opacity: 0.65;\n    "],["\n      cursor: default;\n      pointer-events: none;\n      opacity: 0.65;\n    "])))}),(function(n){return n.active&&e(w||(w=f(["\n      &:before {\n        transform: rotate(90deg);\n      }\n      &:after {\n        transform: rotate(180deg);\n      }\n    "],["\n      &:before {\n        transform: rotate(90deg);\n      }\n      &:after {\n        transform: rotate(180deg);\n      }\n    "])))})),N=n.div(C||(C=f(["\n  > .rdk-tree-item:first-child {\n    &::before {\n      height: 100%;\n      top: 15px;\n    }\n  }\n  > .rdk-tree-item:only-child::before {\n    border: 0px !important;\n  }\n"],["\n  > .rdk-tree-item:first-child {\n    &::before {\n      height: 100%;\n      top: 15px;\n    }\n  }\n  > .rdk-tree-item:only-child::before {\n    border: 0px !important;\n  }\n"]))),R=function(n){var e=n.children,o=n.className;return t.createElement(N,{className:d.joinClass("rdk-tree-root rdk-tree-view",o)},e)},T=o({}),j=function(n){var e=n.children,o=n.className,r=n.effectData,c=void 0===r?[]:r,s=n.maxHeight,f=n.maxWidth,h=n.width,x=n.height,m=n.always,g=void 0===m||m,b=n.refScroll,v=n.onScrollY,w=n.onScrollX,k=n.onScrollUp,C=n.onScrollDown,S=n.onScrollLeft,y=n.onScrollRight,E=n.onYReachStart,N=n.onYReachEnd,j=n.onXReachStart,X=n.onXReachEnd,Y=i(),L=l([]),z=L[0],B=L[1],D=l(0),A=D[0],H=D[1];a((function(){if(z.length>0){var n=z[0],e=z[1];if(!e)return;H(+new Date);var t=e,o=Y.current,r=o.element.getBoundingClientRect(),i=t.getBoundingClientRect();if(r.bottom===i.bottom)return void o.update();var l=o.element.scrollTop,a=i.top-r.top;if(n){var c=a+l,s=parseInt(t.style.paddingTop||0)||0;if(l=c-s,a/o.containerHeight<.7&&a>s)return void o.update();d.scrollTo(o.element,l,500)}else{var p=i.bottom-r.bottom;if(p<i.height&&p>0)return d.scrollTo(o.element,a+l,500),void o.update();var u=(m=o.element,g="span.node-content",v=Array.from(m.querySelectorAll(g)).reverse(),w=v.findIndex((function(n){return d.isVisible(n)})),v[w]);if(!u)return;var f=u.getBoundingClientRect(),h=r.bottom-f.top-f.height;if(h>=i.height){var x=o.element.scrollHeight-h;d.scrollTo(o.element,x,500)}else i.top<r.top&&d.scrollTo(o.element,a+l,500);o.update()}}var m,g,v,w;b&&!b.current&&(b.current=Y.current)}),[z,b]);return t.createElement(T.Provider,{value:{notifyToggle:function(n){return B(u(u([],n,!0),[+new Date],!1))},flagHeight:A}},t.createElement(p,{refScroll:Y,effectData:c,className:d.joinClass("rdk-tree-scroll",o),maxHeight:s,maxWidth:f,width:h,height:x,always:g,onScrollY:v,onScrollX:w,onScrollUp:k,onScrollDown:C,onScrollLeft:S,onScrollRight:y,onYReachStart:E,onYReachEnd:N,onXReachStart:j,onXReachEnd:X},t.createElement(R,null,e)))};var X=function(n){var e=n.children;return s.isFunc(e)?e():e},Y=function(n){var e=n.children;return n.isActive&&e?t.createElement("div",{className:"rdk-tree-view"},e):null},L=t.memo((function(n){var e=n.children,o=n.id,i=n.className,a=n.iconClassName,p=n.showCheckbox,u=n.checkboxName,f=n.checkboxClassName,h=n.labelCheckboxText,x=n.labelCheckboxClassName,m=n.nodeContent,g=n.isOpen,b=void 0!==g&&g,v=n.disabled,w=void 0!==v&&v,k=n.fullRowSelection,C=void 0!==k&&k,N=n.selectedWhenToggle,R=void 0!==N&&N,j=n.selectedColor,L=void 0===j?"#000":j,z=n.selectedBgColor,B=void 0===z?"transparent":z,D=n.lineColor,A=void 0===D?"#92adc0":D,H=n.selected,F=void 0!==H&&H,I=n.hideNodeIcon,O=n.showXLine,P=void 0===O||O,V=n.showYLine,W=void 0===V||V,U=n.selfData,q=n.onClick,G=void 0===q?function(){}:q,J=n.onToggle,K=void 0===J?function(){}:J,M=(r(T)||{}).notifyToggle,Q=l(b),Z=Q[0],$=Q[1],_=l(F),nn=_[0],en=_[1];function tn(n){w||(rn(n),R&&ln(n))}function on(n){!w&&R&&rn(n),ln(n)}function rn(n){s.isFunc(M)&&M([!Z,n.target.closest("span.node-content")]),s.isFunc(K)&&K(!Z,U),$(!Z)}function ln(n){en(!nn),s.isFunc(G)&&G(n,!nn,U)}return c((function(){return en(F)}),[F]),c((function(){return $(b)}),[b]),t.createElement(S,{id:o,className:d.joinClass("rdk-tree-item",{"has-child":!!e},{"is-active":Z},i),showXLine:P,showYLine:W,lineColor:A},t.createElement(y,{className:d.joinClass("node-content",{"is-active":Z},{disabled:w},{selected:nn}),nodeSelected:nn,selectedColor:L,selectedBgColor:B,fullRowSelection:C},t.createElement("div",null,!I&&t.createElement(E,{className:d.joinClass("node-icon",a),active:Z,disabled:w,selectedColor:L,nodeSelected:nn,onClick:tn}),p&&t.createElement("span",{className:"node-cbx"},t.createElement("input",{type:"checkbox",name:u,className:d.joinClass("node-cbx-icon",f),checked:Z,disabled:w,onChange:tn}),t.createElement("label",{className:d.joinClass("node-cbx-label",R&&"node-data-text-toggle",x),onClick:on},h)),t.createElement("span",{className:d.joinClass("node-data-text",R&&"node-data-text-toggle"),onClick:on},t.createElement(X,null,m)))),t.createElement(Y,{isActive:Z},e))}));export{N as StyledTreeContainer,S as StyledTreeItem,y as StyledTreeItemContent,E as StyledTreeItemIcon,L as TreeItem,j as TreeScrollView,R as TreeView};
